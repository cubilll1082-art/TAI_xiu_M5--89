<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Admin - Tai Xiu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
    * {
        box-sizing: border-box;
    }
    body {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #fff;
    }
    .container {
        max-width: 500px;
        margin: 0 auto;
    }
    .header {
        text-align: center;
        padding: 20px;
        background: rgba(0,0,0,0.3);
        border-radius: 15px;
        margin-bottom: 20px;
    }
    .header h1 {
        color: #e94560;
        margin: 0;
        font-size: 24px;
    }
    .login-box, .admin-panel {
        background: rgba(0,0,0,0.3);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .admin-panel {
        display: none;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #ccc;
    }
    .form-group input {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        background: rgba(255,255,255,0.1);
        color: #fff;
    }
    .btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
    }
    .btn-primary {
        background: #e94560;
        color: #fff;
    }
    .btn-primary:hover {
        background: #ff6b6b;
    }
    .status-box {
        background: rgba(0,0,0,0.3);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .status-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .status-item:last-child {
        border-bottom: none;
    }
    .status-label {
        color: #888;
    }
    .status-value {
        font-weight: bold;
        color: #fff;
    }
    .control-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    .btn-tai {
        flex: 1;
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
        color: #fff;
        font-size: 18px;
        padding: 15px;
    }
    .btn-xiu {
        flex: 1;
        background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
        color: #fff;
        font-size: 18px;
        padding: 15px;
    }
    .btn:active {
        transform: scale(0.95);
    }
    .message {
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        display: none;
    }
    .message.success {
        background: rgba(76, 175, 80, 0.3);
        color: #4caf50;
        display: block;
    }
    .message.error {
        background: rgba(244, 67, 54, 0.3);
        color: #f44336;
        display: block;
    }
    .current-result {
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
    }
    .current-result.tai {
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
    }
    .current-result.xiu {
        background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
    }
    .current-result.none {
        background: rgba(255,255,255,0.1);
        color: #888;
    }
    .dice-control {
        background: rgba(0,0,0,0.3);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
    }
    .dice-control h3 {
        margin: 0 0 15px 0;
        color: #ffd700;
        text-align: center;
    }
    .dice-inputs {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 15px;
    }
    .dice-input-group {
        text-align: center;
    }
    .dice-input-group label {
        display: block;
        color: #888;
        font-size: 12px;
        margin-bottom: 5px;
    }
    .dice-input {
        width: 70px;
        height: 70px;
        text-align: center;
        font-size: 36px;
        font-weight: bold;
        border: 3px solid #ffd700;
        border-radius: 10px;
        background: rgba(255,255,255,0.1);
        color: #fff;
        outline: none;
    }
    .dice-input:focus {
        background: rgba(255,215,0,0.2);
    }
    .dice-total {
        text-align: center;
        font-size: 18px;
        color: #ffd700;
        margin: 10px 0;
    }
    .dice-row {
        margin-bottom: 15px;
    }
    .row-label {
        display: block;
        color: #888;
        font-size: 14px;
        margin-bottom: 8px;
    }
    .dice-btns {
        display: flex;
        justify-content: space-between;
        gap: 5px;
    }
    .btn-dice-val {
        flex: 1;
        aspect-ratio: 1/1;
        border: 2px solid #ffd700;
        background: rgba(255,255,255,0.1);
        color: #fff;
        border-radius: 8px;
        font-weight: bold;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .btn-dice-val.active {
        background: #ffd700;
        color: #000;
    }
    .btn-set-dice {
        background: linear-gradient(135deg, #ffd700, #ffa500);
        color: #000;
        font-weight: bold;
    }
    .history-section {
        background: rgba(0,0,0,0.3);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
    }
    .history-section h3 {
        margin: 0 0 15px 0;
        color: #e94560;
    }
    .history-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    .history-item {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        color: #fff;
    }
    .history-item.tai {
        background: linear-gradient(135deg, #4ecdc4, #44a08d);
    }
    .history-item.xiu {
        background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
    }
    .back-link {
        text-align: center;
        margin-top: 20px;
    }
    .back-link a {
        color: #e94560;
        text-decoration: none;
    }
    .section-title {
        color: #fff;
        margin: 20px 0 10px 0;
        font-size: 16px;
    }
    .section-desc {
        color: #888;
        font-size: 13px;
        margin: 0 0 15px 0;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ADMIN PANEL</h1>
        </div>
        
        <div class="login-box" id="loginBox">
            <div class="form-group">
                <label>Mat khau Admin</label>
                <input type="password" id="password" placeholder="Nhap mat khau">
            </div>
            <button class="btn btn-primary" id="loginBtn">Dang nhap</button>
            <div class="message" id="loginMsg"></div>
        </div>
        
        <div class="admin-panel" id="adminPanel">
            <div class="status-box">
                <div class="status-item">
                    <span class="status-label">Phien hien tai</span>
                    <span class="status-value" id="currentPhien">#0</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Thoi gian con lai</span>
                    <span class="status-value" id="timeLeft">60s</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Trang thai</span>
                    <span class="status-value" id="gameStatus">Dang cho</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Tien dat TAI</span>
                    <span class="status-value" id="taiMoney">0k</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Tien dat XIU</span>
                    <span class="status-value" id="xiuMoney">0k</span>
                </div>
            </div>
            
            <div class="dice-control">
                <h3>DIEU KHIEN 3 XUC XAC</h3>
                <p class="section-desc" style="text-align: center;">Chon gia tri cho tung xuc xac</p>
                <div id="quickDiceControl">
                    <div class="dice-row" id="row1">
                        <span class="row-label">Xuc xac 1:</span>
                        <div class="dice-btns">
                            <button class="btn-dice-val" data-dice="1" data-val="1">1</button>
                            <button class="btn-dice-val" data-dice="1" data-val="2">2</button>
                            <button class="btn-dice-val" data-dice="1" data-val="3">3</button>
                            <button class="btn-dice-val" data-dice="1" data-val="4">4</button>
                            <button class="btn-dice-val" data-dice="1" data-val="5">5</button>
                            <button class="btn-dice-val" data-dice="1" data-val="6">6</button>
                        </div>
                    </div>
                    <div class="dice-row" id="row2">
                        <span class="row-label">Xuc xac 2:</span>
                        <div class="dice-btns">
                            <button class="btn-dice-val" data-dice="2" data-val="1">1</button>
                            <button class="btn-dice-val" data-dice="2" data-val="2">2</button>
                            <button class="btn-dice-val" data-dice="2" data-val="3">3</button>
                            <button class="btn-dice-val" data-dice="2" data-val="4">4</button>
                            <button class="btn-dice-val" data-dice="2" data-val="5">5</button>
                            <button class="btn-dice-val" data-dice="2" data-val="6">6</button>
                        </div>
                    </div>
                    <div class="dice-row" id="row3">
                        <span class="row-label">Xuc xac 3:</span>
                        <div class="dice-btns">
                            <button class="btn-dice-val" data-dice="3" data-val="1">1</button>
                            <button class="btn-dice-val" data-dice="3" data-val="2">2</button>
                            <button class="btn-dice-val" data-dice="3" data-val="3">3</button>
                            <button class="btn-dice-val" data-dice="3" data-val="4">4</button>
                            <button class="btn-dice-val" data-dice="3" data-val="5">5</button>
                            <button class="btn-dice-val" data-dice="3" data-val="6">6</button>
                        </div>
                    </div>
                </div>
                <div class="dice-inputs" style="display:none">
                    <div class="dice-input-group">
                        <label>Xuc xac 1</label>
                        <input type="number" class="dice-input" id="dice1" min="1" max="6" value="1">
                    </div>
                    <div class="dice-input-group">
                        <label>Xuc xac 2</label>
                        <input type="number" class="dice-input" id="dice2" min="1" max="6" value="1">
                    </div>
                    <div class="dice-input-group">
                        <label>Xuc xac 3</label>
                        <input type="number" class="dice-input" id="dice3" min="1" max="6" value="1">
                    </div>
                </div>
                <div class="dice-total" id="diceTotal">Tong: 3 = XIU</div>
                <button class="btn btn-set-dice" id="setDiceBtn">DAT XUC XAC</button>
            </div>
            
            <h3 class="section-title">Hoac chon nhanh:</h3>
            <p class="section-desc">He thong se tu dong chon xuc xac ngau nhien theo ket qua ban chon</p>
            <div class="control-buttons">
                <button class="btn btn-xiu" id="setXiu">DAT XIU</button>
                <button class="btn btn-tai" id="setTai">DAT TAI</button>
            </div>
            
            <div class="current-result none" id="currentResult">
                Chua dat ket qua
            </div>
            
            <div class="message" id="adminMsg"></div>
            
            <div class="history-section">
                <h3>Lich su ket qua</h3>
                <div class="history-list" id="historyList"></div>
            </div>
        </div>
        
        <div class="back-link">
            <a href="/">Quay lai game</a>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
    var socket = io();
    var password = '';
    var isLoggedIn = false;
    
    function showMessage(elementId, msg, type) {
        var el = document.getElementById(elementId);
        el.textContent = msg;
        el.className = 'message ' + type;
        setTimeout(function() {
            el.className = 'message';
        }, 3000);
    }
    
    function updateHistory(history) {
        var html = '';
        history.forEach(function(item) {
            html += '<div class="history-item ' + item.ketQua.result + '">' + 
                    (item.ketQua.result === 'tai' ? 'T' : 'X') + '</div>';
        });
        document.getElementById('historyList').innerHTML = html;
    }
    
    function updateDiceTotal() {
        var d1 = parseInt(document.getElementById('dice1').value) || 1;
        var d2 = parseInt(document.getElementById('dice2').value) || 1;
        var d3 = parseInt(document.getElementById('dice3').value) || 1;
        var total = d1 + d2 + d3;
        var result = total <= 10 ? 'XIU' : 'TAI';
        document.getElementById('diceTotal').textContent = 'Tong: ' + total + ' = ' + result;
    }
    
    document.getElementById('dice1').addEventListener('input', updateDiceTotal);
    document.getElementById('dice2').addEventListener('input', updateDiceTotal);
    document.getElementById('dice3').addEventListener('input', updateDiceTotal);
    
    document.querySelectorAll('.btn-dice-val').forEach(btn => {
        btn.addEventListener('click', function() {
            const diceNum = this.getAttribute('data-dice');
            const val = this.getAttribute('data-val');
            
            // Update inputs (hidden)
            document.getElementById('dice' + diceNum).value = val;
            
            // Update UI state
            document.querySelectorAll(`.btn-dice-val[data-dice="${diceNum}"]`).forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            updateDiceTotal();
        });
    });

    // Initialize active states
    document.querySelectorAll('.btn-dice-val[data-val="1"]').forEach(b => b.classList.add('active'));
    
    document.getElementById('loginBtn').addEventListener('click', function() {
        password = document.getElementById('password').value;
        socket.emit('adminGetStatus', { password: password });
    });
    
    document.getElementById('password').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('loginBtn').click();
        }
    });
    
    document.getElementById('setTai').addEventListener('click', function() {
        socket.emit('adminSetResult', { password: password, result: 'tai' });
    });
    
    document.getElementById('setXiu').addEventListener('click', function() {
        socket.emit('adminSetResult', { password: password, result: 'xiu' });
    });
    
    document.getElementById('setDiceBtn').addEventListener('click', function() {
        var d1 = parseInt(document.getElementById('dice1').value);
        var d2 = parseInt(document.getElementById('dice2').value);
        var d3 = parseInt(document.getElementById('dice3').value);
        socket.emit('adminSetDice', { password: password, dice1: d1, dice2: d2, dice3: d3 });
    });
    
    socket.on('adminStatus', function(data) {
        isLoggedIn = true;
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        updateStatus(data);
        updateHistory(data.history || []);
    });
    
    socket.on('adminResponse', function(data) {
        if (data.status === 'success') {
            var r = data.result;
            var msg = 'Da dat: ' + r.dice1 + ' + ' + r.dice2 + ' + ' + r.dice3 + ' = ' + (r.dice1+r.dice2+r.dice3) + ' (' + r.result.toUpperCase() + ')';
            showMessage('adminMsg', msg, 'success');
            var resultEl = document.getElementById('currentResult');
            resultEl.textContent = msg;
            resultEl.className = 'current-result ' + r.result;
        } else {
            if (data.error === 'Sai mat khau') {
                showMessage('loginMsg', data.error, 'error');
            } else {
                showMessage('adminMsg', data.error, 'error');
            }
        }
    });
    
    socket.on('gameData', function(data) {
        if (isLoggedIn) {
            document.getElementById('currentPhien').textContent = '#' + data.idGame;
            document.getElementById('timeLeft').textContent = data.time + 's';
            document.getElementById('taiMoney').textContent = Math.floor(data.tongTienDatTai / 1000) + 'k (' + data.soNguoiChonTai + ' nguoi)';
            document.getElementById('xiuMoney').textContent = Math.floor(data.tongTienDatXiu / 1000) + 'k (' + data.soNguoiChonXiu + ' nguoi)';
            
            if (data.adminResult) {
                var r = data.adminResult;
                var resultEl = document.getElementById('currentResult');
                resultEl.textContent = 'Da dat: ' + r.dice1 + ' + ' + r.dice2 + ' + ' + r.dice3 + ' = ' + (r.dice1+r.dice2+r.dice3) + ' (' + r.result.toUpperCase() + ')';
                resultEl.className = 'current-result ' + r.result;
            }
        }
    });
    
    socket.on('gameStart', function() {
        if (isLoggedIn) {
            document.getElementById('gameStatus').textContent = 'Dang choi';
            var resultEl = document.getElementById('currentResult');
            resultEl.textContent = 'Chua dat ket qua';
            resultEl.className = 'current-result none';
        }
    });
    
    socket.on('gameOver', function() {
        if (isLoggedIn) {
            document.getElementById('gameStatus').textContent = 'Cho phien moi';
        }
    });
    
    socket.on('historyUpdate', function(history) {
        if (isLoggedIn) {
            updateHistory(history);
        }
    });
    
    function updateStatus(data) {
        document.getElementById('currentPhien').textContent = '#' + data.idPhien;
        document.getElementById('timeLeft').textContent = data.time + 's';
        document.getElementById('gameStatus').textContent = data.coTheDatCuoc ? 'Dang choi' : 'Cho phien moi';
        document.getElementById('taiMoney').textContent = Math.floor(data.tongTienDatTai / 1000) + 'k (' + data.soNguoiChonTai + ' nguoi)';
        document.getElementById('xiuMoney').textContent = Math.floor(data.tongTienDatXiu / 1000) + 'k (' + data.soNguoiChonXiu + ' nguoi)';
        
        if (data.adminResult) {
            var r = data.adminResult;
            var resultEl = document.getElementById('currentResult');
            resultEl.textContent = 'Da dat: ' + r.dice1 + ' + ' + r.dice2 + ' + ' + r.dice3 + ' = ' + (r.dice1+r.dice2+r.dice3) + ' (' + r.result.toUpperCase() + ')';
            resultEl.className = 'current-result ' + r.result;
        }
    }
    </script>
</body>
</html>
